<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CE-QUAL-W2 Test Harness</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.1em;
            color: #666;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .control-group select,
        .control-group input {
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(45deg, #6c757d, #868e96);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .btn.secondary:hover {
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-card {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            border: 2px solid #dee2e6;
            transition: transform 0.3s ease;
        }

        .status-card:hover {
            transform: translateY(-3px);
        }

        .status-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .status-card p {
            color: #666;
            font-weight: 500;
        }

        .status-card.success h3 {
            color: #28a745;
        }

        .status-card.warning h3 {
            color: #ffc107;
        }

        .status-card.error h3 {
            color: #dc3545;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #e0e6ed;
            padding-bottom: 10px;
        }

        .chart-container {
            height: 400px;
            background: #f8f9fa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .chart-placeholder {
            position: relative;
            z-index: 2;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            z-index: 1;
        }

        .results-table {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            grid-column: 1 / -1;
        }

        .results-table h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #e0e6ed;
            padding-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e0e6ed;
        }

        tr:nth-child(even) td {
            background-color: #f8f9fa;
        }

        tr:hover td {
            background-color: rgba(102, 126, 234, 0.05);
        }

        .pass {
            color: #28a745;
            font-weight: 600;
        }

        .fail {
            color: #dc3545;
            font-weight: 600;
        }

        .warning {
            color: #ffc107;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e6ed;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .log-container {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-container::-webkit-scrollbar {
            width: 8px;
        }

        .log-container::-webkit-scrollbar-track {
            background: #34495e;
        }

        .log-container::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #000;
        }

        .animated {
            animation: slideInUp 0.5s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
            
            .status-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header animated">
            <h1>CE-QUAL-W2 Test Harness</h1>
            <p>Comprehensive model version comparison and regression testing platform</p>
        </div>

        <!-- Controls -->
        <div class="controls animated">
            <div class="control-grid">
                <div class="control-group">
                    <label for="baseline-version">Baseline Version:</label>
                    <select id="baseline-version">
                        <option value="v4.5">CE-QUAL-W2 v4.5 (Stable)</option>
                        <option value="v4.6">CE-QUAL-W2 v4.6</option>
                        <option value="v5.0beta">CE-QUAL-W2 v5.0 Beta</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="test-version">Test Version:</label>
                    <select id="test-version">
                        <option value="v5.0beta" selected>CE-QUAL-W2 v5.0 Beta</option>
                        <option value="v5.1dev">CE-QUAL-W2 v5.1 Dev</option>
                        <option value="custom">Custom Build</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="test-suite">Test Suite:</label>
                    <select id="test-suite">
                        <option value="full">Full Regression Suite</option>
                        <option value="quick">Quick Validation Tests</option>
                        <option value="performance">Performance Tests</option>
                        <option value="custom">Custom Test Set</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="tolerance">Tolerance Level:</label>
                    <select id="tolerance">
                        <option value="strict">Strict (0.1%)</option>
                        <option value="normal" selected>Normal (1%)</option>
                        <option value="relaxed">Relaxed (5%)</option>
                    </select>
                </div>
            </div>
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn" onclick="runTests()">
                    <span id="run-btn-text">Run Comparison Tests</span>
                </button>
                <button class="btn secondary" onclick="loadConfiguration()">Load Config</button>
                <button class="btn secondary" onclick="exportResults()">Export Results</button>
                <button class="btn secondary" onclick="viewDetails()">View Details</button>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar animated">
            <div class="status-grid">
                <div class="status-card" id="total-tests">
                    <h3>24</h3>
                    <p>Total Tests</p>
                </div>
                <div class="status-card success" id="passed-tests">
                    <h3>18</h3>
                    <p>Passed</p>
                </div>
                <div class="status-card warning" id="warning-tests">
                    <h3>4</h3>
                    <p>Warnings</p>
                </div>
                <div class="status-card error" id="failed-tests">
                    <h3>2</h3>
                    <p>Failed</p>
                </div>
                <div class="status-card" id="runtime">
                    <h3>12.5m</h3>
                    <p>Runtime</p>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Comparison Results Chart -->
            <div class="panel animated">
                <h2>Statistical Comparison</h2>
                <div class="chart-container">
                    <div class="chart-placeholder">
                        Time-Series Difference Analysis<br>
                        <small>RMSE: 0.0023 | MAE: 0.0018 | Correlation: 0.9987</small>
                    </div>
                </div>
            </div>

            <!-- Performance Analysis -->
            <div class="panel animated">
                <h2>Performance Metrics</h2>
                <div class="chart-container">
                    <div class="chart-placeholder">
                        Runtime Comparison<br>
                        <small>v4.5: 8.2min | v5.0β: 7.1min | Speedup: 13.4%</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Table -->
        <div class="results-table animated">
            <h2>Test Case Results</h2>
            <table>
                <thead>
                    <tr>
                        <th>Test Case</th>
                        <th>Status</th>
                        <th>RMSE</th>
                        <th>Max Diff (%)</th>
                        <th>Runtime (min)</th>
                        <th>Memory (MB)</th>
                        <th>Issues</th>
                    </tr>
                </thead>
                <tbody id="results-tbody">
                    <tr>
                        <td>Long Lake - Summer Stratification</td>
                        <td><span class="pass">PASS</span></td>
                        <td>0.0023</td>
                        <td>0.15</td>
                        <td>2.3</td>
                        <td>145</td>
                        <td>None</td>
                    </tr>
                    <tr>
                        <td>Reservoir - Ice Coverage</td>
                        <td><span class="pass">PASS</span></td>
                        <td>0.0041</td>
                        <td>0.28</td>
                        <td>1.8</td>
                        <td>132</td>
                        <td>Minor precision diff</td>
                    </tr>
                    <tr>
                        <td>River - High Flow Event</td>
                        <td><span class="warning">WARN</span></td>
                        <td>0.0089</td>
                        <td>1.2</td>
                        <td>3.1</td>
                        <td>178</td>
                        <td>Mass balance variation</td>
                    </tr>
                    <tr>
                        <td>Estuary - Salinity Gradient</td>
                        <td><span class="pass">PASS</span></td>
                        <td>0.0034</td>
                        <td>0.22</td>
                        <td>2.7</td>
                        <td>156</td>
                        <td>None</td>
                    </tr>
                    <tr>
                        <td>Deep Lake - Thermal Dynamics</td>
                        <td><span class="fail">FAIL</span></td>
                        <td>0.0156</td>
                        <td>2.8</td>
                        <td>4.2</td>
                        <td>203</td>
                        <td>Convergence issue</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Log Output -->
        <div class="panel animated">
            <h2>Test Execution Log</h2>
            <div class="log-container" id="log-container">
                <div>[2025-07-18 10:15:23] Starting CE-QUAL-W2 version comparison...</div>
                <div>[2025-07-18 10:15:24] Loading test configuration: full_regression_suite.yaml</div>
                <div>[2025-07-18 10:15:25] Initializing baseline version v4.5</div>
                <div>[2025-07-18 10:15:26] Initializing test version v5.0beta</div>
                <div>[2025-07-18 10:15:27] Setting up isolated test environments</div>
                <div>[2025-07-18 10:15:28] Running test: Long Lake - Summer Stratification</div>
                <div>[2025-07-18 10:17:32] ✓ Long Lake test completed successfully</div>
                <div>[2025-07-18 10:17:33] Running test: Reservoir - Ice Coverage</div>
                <div>[2025-07-18 10:19:15] ✓ Reservoir test completed with minor warnings</div>
                <div>[2025-07-18 10:19:16] Running test: River - High Flow Event</div>
                <div>[2025-07-18 10:22:18] ⚠ River test completed with mass balance variations</div>
                <div>[2025-07-18 10:22:19] Running test: Estuary - Salinity Gradient</div>
                <div>[2025-07-18 10:24:58] ✓ Estuary test completed successfully</div>
                <div>[2025-07-18 10:24:59] Running test: Deep Lake - Thermal Dynamics</div>
                <div>[2025-07-18 10:29:12] ✗ Deep Lake test failed - convergence issues detected</div>
                <div>[2025-07-18 10:29:13] Generating comparison reports...</div>
                <div>[2025-07-18 10:29:45] Test suite completed. View detailed results above.</div>
            </div>
        </div>
    </div>

    <!-- Modal for detailed results -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Detailed Test Analysis</h2>
            <div id="modal-content">
                <h3>Deep Lake - Thermal Dynamics (FAILED)</h3>
                <p><strong>Issue:</strong> Model convergence failure in thermal stratification calculations</p>
                <p><strong>Error Location:</strong> Thermal mixing subroutine, line 2847</p>
                <p><strong>Baseline Behavior:</strong> Stable convergence within 15 iterations</p>
                <p><strong>Test Version Behavior:</strong> Oscillating solution, exceeded 50 iteration limit</p>
                <p><strong>Recommended Action:</strong> Review thermal mixing algorithm changes in v5.0beta</p>
                
                <h3>Statistical Summary</h3>
                <table style="margin-top: 15px;">
                    <tr><th>Metric</th><th>Value</th><th>Tolerance</th><th>Status</th></tr>
                    <tr><td>RMSE</td><td>0.0156</td><td>< 0.01</td><td class="fail">FAIL</td></tr>
                    <tr><td>Maximum Difference</td><td>2.8%</td><td>< 1%</td><td class="fail">FAIL</td></tr>
                    <tr><td>Mass Balance Error</td><td>0.12%</td><td>< 0.1%</td><td class="warning">WARN</td></tr>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Simulated test data
        let testProgress = 0;
        let isRunning = false;
        let testResults = [];

        // Initialize the application
        function initializeApp() {
            updateProgress(75);
            generateMockResults();
        }

        // Run comparison tests
        function runTests() {
            if (isRunning) return;
            
            isRunning = true;
            const runBtn = document.getElementById('run-btn-text');
            runBtn.textContent = 'Running Tests...';
            
            // Reset progress
            testProgress = 0;
            updateProgress(0);
            
            // Clear log
            const logContainer = document.getElementById('log-container');
            logContainer.innerHTML = '';
            
            // Simulate test execution
            simulateTestExecution();
        }

        function simulateTestExecution() {
            const tests = [
                'Long Lake - Summer Stratification',
                'Reservoir - Ice Coverage', 
                'River - High Flow Event',
                'Estuary - Salinity Gradient',
                'Deep Lake - Thermal Dynamics'
            ];
            
            const logContainer = document.getElementById('log-container');
            let currentTest = 0;
            
            function runNextTest() {
                if (currentTest >= tests.length) {
                    // All tests complete
                    addLogEntry('Test suite completed. Generating reports...');
                    setTimeout(() => {
                        addLogEntry('✓ All reports generated successfully');
                        updateProgress(100);
                        isRunning = false;
                        document.getElementById('run-btn-text').textContent = 'Run Comparison Tests';
                        updateStatusCards();
                    }, 1000);
                    return;
                }
                
                const testName = tests[currentTest];
                addLogEntry(`Running test: ${testName}`);
                
                // Simulate test duration (2-4 seconds)
                const duration = Math.random() * 2000 + 2000;
                
                setTimeout(() => {
                    const success = Math.random() > 0.3; // 70% success rate
                    const status = success ? '✓' : (Math.random() > 0.5 ? '⚠' : '✗');
                    const message = success ? 'completed successfully' : 
                                   status === '⚠' ? 'completed with warnings' : 'failed';
                    
                    addLogEntry(`${status} ${testName} ${message}`);
                    
                    testProgress = ((currentTest + 1) / tests.length) * 100;
                    updateProgress(testProgress);
                    
                    currentTest++;
                    setTimeout(runNextTest, 500);
                }, duration);
            }
            
            addLogEntry('Starting CE-QUAL-W2 version comparison...');
            addLogEntry('Loading test configuration...');
            setTimeout(runNextTest, 1000);
        }

        function addLogEntry(message) {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateProgress(percentage) {
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = percentage + '%';
        }

        function updateStatusCards() {
            // Simulate updated statistics
            const stats = {
                total: Math.floor(Math.random() * 10) + 20,
                passed: 0,
                warnings: 0,
                failed: 0
            };
            
            stats.passed = Math.floor(stats.total * 0.7);
            stats.warnings = Math.floor(stats.total * 0.2);
            stats.failed = stats.total - stats.passed - stats.warnings;
            
            document.querySelector('#total-tests h3').textContent = stats.total;
            document.querySelector('#passed-tests h3').textContent = stats.passed;
            document.querySelector('#warning-tests h3').textContent = stats.warnings;
            document.querySelector('#failed-tests h3').textContent = stats.failed;
            document.querySelector('#runtime h3').textContent = (Math.random() * 10 + 5).toFixed(1) + 'm';
        }

        function generateMockResults() {
            const tbody = document.getElementById('results-tbody');
            const testCases = [
                ['Long Lake - Summer Stratification', 'PASS', '0.0023', '0.15', '2.3', '145', 'None'],
                ['Reservoir - Ice Coverage', 'PASS', '0.0041', '0.28', '1.8', '132', 'Minor precision diff'],
                ['River - High Flow Event', 'WARN', '0.0089', '1.2', '3.1', '178', 'Mass balance variation'],
                ['Estuary - Salinity Gradient', 'PASS', '0.0034', '0.22', '2.7', '156', 'None'],
                ['Deep Lake - Thermal Dynamics', 'FAIL', '0.0156', '2.8', '4.2', '203', 'Convergence issue']
            ];
            
            tbody.innerHTML = '';
            testCases.forEach(testCase => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${testCase[0]}</td>
                    <td><span class="${testCase[1].toLowerCase()}">${testCase[1]}</span></td>
                    <td>${testCase[2]}</td>
                    <td>${testCase[3]}</td>
                    <td>${testCase[4]}</td>
                    <td>${testCase[5]}</td>
                    <td>${testCase[6]}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadConfiguration() {
            alert('Loading configuration dialog would open here. This would allow users to load different test suite configurations.');
        }

        function exportResults() {
            const data = {
                testSuite: 'Full Regression Suite',
                baseline: 'v4.5',
                testVersion: 'v5.0beta',
                timestamp: new Date().toISOString(),
                summary: {
                    total: 24,
                    passed: 18,
                    warnings: 4,
                    failed: 2,
                    runtime: '12.5m'
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cequalw2_test_results.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function viewDetails() {
            const modal = document.getElementById('detailModal');
            modal.style.display = 'block';
        